# Prism - 功能需求文档

> 基于 SourceTree 的 UI 和功能设计，打造更快、更轻量的 Git 客户端

## 1. 核心功能需求

### 1.0 仓库列表窗口（启动页）

#### 1.0.1 窗口展示
- [ ] 启动应用时默认显示仓库列表窗口
- [ ] 窗口标题："Prism - 仓库列表"
- [ ] 推荐尺寸：800x600px
- [ ] 可调整大小，记住用户偏好

#### 1.0.2 添加仓库
- [ ] **从本地添加**
  - 点击"添加本地仓库"按钮
  - 打开文件夹选择对话框
  - 验证选择的目录是否为 Git 仓库
  - 自动识别仓库名称（从路径）
  - 添加到仓库列表

- [ ] **从远程克隆**
  - 点击"克隆仓库"按钮
  - 弹出克隆对话框
    - 输入远程 URL（支持 HTTPS/SSH）
    - 选择本地保存路径
    - 可选：指定分支
  - 显示克隆进度（进度条）
  - 克隆完成后自动添加到列表

#### 1.0.3 仓库列表展示
- [ ] 每个仓库项显示：
  - 仓库图标（Git 图标）
  - 仓库名称（可编辑）
  - 仓库路径（灰色小字）
  - 当前分支（徽章显示）
  - 最后打开时间

- [ ] 列表排序
  - 默认按最后打开时间倒序
  - 支持按名称字母排序
  - 支持按路径排序

- [ ] 搜索过滤
  - 顶部搜索框
  - 实时过滤仓库列表
  - 按名称或路径匹配

#### 1.0.4 仓库操作
- [ ] **双击打开** - 打开仓库主界面
- [ ] **右键菜单**
  - 打开 (⌘O)
  - 在 Finder 中显示 (Show in Finder)
  - 在终端中打开 (Open in Terminal)
  - 重命名
  - 从列表中移除（不删除文件）
  - 删除仓库（移到废纸篓，需确认）

- [ ] **快捷键支持**
  - Enter/双击 - 打开仓库
  - Delete - 从列表移除
  - ⌘R - 重命名
  - ⌘F - 聚焦搜索框

#### 1.0.5 仓库状态指示
- [ ] 仓库健康状态
  - ✅ 正常（绿色图标）
  - ⚠️ 路径不存在（黄色警告）
  - ❌ 非 Git 仓库（红色错误）

- [ ] 悬停提示
  - 显示完整路径
  - 显示仓库统计（提交数、分支数）

#### 1.0.6 数据持久化
- [ ] 仓库列表保存到本地配置
- [ ] 格式：JSON 文件
- [ ] 位置：`~/.prism/repositories.json`
- [ ] 包含信息：
  ```json
  {
    "repositories": [
      {
        "id": "uuid",
        "name": "prism",
        "path": "/path/to/repo",
        "addedAt": "2025-01-01T00:00:00Z",
        "lastOpenedAt": "2025-01-02T10:30:00Z"
      }
    ]
  }
  ```

    消息：路径 "/path/to/dir" 不是一个 Git 仓库

    按钮：
    - 取消（关闭对话框）
    - 创建仓库（执行 git init）
    ```

- [ ] **打开仓库**
  - 如果是有效仓库，直接打开仓库主界面
  - 跳过仓库列表窗口（除非使用 `prism` 无参数）
  - 加载仓库信息（分支、文件状态等）

- [ ] **添加到列表提示**
  - 仓库打开后，检查是否在仓库列表中
  - 如果不在列表，显示提示条（Toast/Banner）：
    ```
    💡 是否将此仓库添加到列表？
    [添加] [不再提示] [×]
    ```
  - 点击"添加"：添加到仓库列表并保存
  - 点击"不再提示"：记住此仓库，不再询问
  - 点击"×"或忽略：本次不添加

- [ ] **错误处理**
  - 路径不存在：显示错误对话框
  - 权限不足：显示权限错误提示
  - 非 UTF-8 路径：尝试转换或显示错误

- [ ] **使用示例**
  ```bash
  # 从仓库根目录打开
  cd /Users/username/prism
  prism .

  # 从子目录打开（自动定位到根目录）
  cd /Users/username/prism/src/components
  prism .
  # → 打开 /Users/username/prism

  # 打开其他仓库
  prism ~/projects/my-app

  # 只打开仓库列表
  prism
  ```

### 1.1 仓库管理（已在 1.0 仓库列表窗口中实现）
- [x] 打开本地 Git 仓库（从仓库列表）
- [x] 克隆远程仓库（从仓库列表）
- [x] 仓库列表管理（收藏、分组）
- [ ] 多仓库同时打开（标签页）
- [x] 最近访问的仓库

### 1.2 文件状态管理
- [x] 显示未暂存的文件（工作区）
- [x] 显示已暂存的文件（暂存区）
- [ ] 文件状态图标（新建/修改/删除/重命名）
- [ ] Stage 文件（添加到暂存区）
- [ ] Unstage 文件（从暂存区移除）
- [ ] Discard 更改（撤销工作区修改）
- [ ] 文件右键菜单（打开、对比、历史等）

### 1.3 Commit 管理
- [x] 查看提交历史（按时间倒序）
- [ ] Commit 图形化展示（分支线）
- [ ] 创建新提交
- [ ] Amend 上一次提交
- [ ] 提交消息模板
- [ ] 提交签名（GPG）

### 1.4 分支管理
- [ ] 查看本地分支列表
- [ ] 查看远程分支列表
- [ ] 创建新分支
- [ ] 切换分支
- [ ] 删除分支
- [ ] 重命名分支
- [ ] Merge 分支
- [ ] Rebase 分支
- [ ] Cherry-pick 提交

### 1.5 Diff 查看
- [x] 文件差异对比（基础）
- [ ] 语法高亮
- [ ] Side-by-side 视图
- [ ] Inline 视图切换
- [ ] 忽略空白符
- [ ] 上下文行数调整

### 1.6 远程操作
- [ ] Fetch（拉取远程更新）
- [ ] Pull（拉取并合并）
- [ ] Push（推送到远程）
- [ ] 远程仓库管理
- [ ] SSH 密钥管理

### 1.7 高级功能
- [ ] Stash（暂存工作区）
- [ ] Tag 管理
- [ ] Submodule 管理
- [ ] Git LFS 支持
- [ ] Interactive Rebase
- [ ] Conflict 解决工具

### 1.8 搜索和过滤
- [ ] 按作者筛选提交
- [ ] 按日期范围筛选
- [ ] 按提交消息搜索
- [ ] 按文件路径搜索

## 2. UI/UX 需求

### 2.1 布局结构
- **三栏布局**
  - 左侧：侧边栏（导航）
  - 中间：主内容区（文件列表/提交历史）
  - 右侧：详情面板（Diff 视图/Commit 详情）

### 2.2 侧边栏
- **工作区**
  - 文件状态
  - 历史
  - 搜索
- **分支**
  - 本地分支
  - 远程分支
  - Tags
- **Stashes**
- **远程仓库**

### 2.3 工具栏
- 仓库路径显示
- 当前分支显示
- 快捷操作按钮（Pull, Push, Fetch, Commit）
- 搜索框

### 2.4 状态栏
- 当前操作状态
- 仓库统计信息（文件数、提交数）

## 3. 性能需求

### 3.1 响应速度
- 打开仓库 < 100ms
- 加载 1000 个提交 < 200ms
- 文件状态检测 < 50ms
- Diff 计算 < 100ms

### 3.2 内存占用
- 空闲状态 < 100 MB
- 大型仓库（10000+ commits）< 300 MB

### 3.3 并发处理
- 文件监控（实时更新）
- 后台 Fetch
- 异步 Diff 计算

## 4. 用户体验需求

### 4.1 快捷键
- `⌘N` - 新建仓库/克隆
- `⌘O` - 打开仓库
- `⌘R` - 刷新
- `⌘E` - Commit
- `⌘K` - 推送
- `⌘L` - 拉取
- `⌘F` - 搜索

### 4.2 可视化
- 分支图（网络拓扑）
- 彩色状态标识
- 图标系统（文件类型、状态）

### 4.3 国际化
- 完整中文支持
- 中文输入法支持
- 日期时间本地化

## 5. 技术需求

### 5.1 后端
- Rust + git2
- tokio 异步运行时
- serde 序列化

### 5.2 前端
- React + TypeScript
- CSS Modules 或 styled-components
- React Query（数据缓存）
- Monaco Editor（代码 Diff）

### 5.3 通信
- Tauri IPC
- 事件监听（文件变更）

## 6. 优先级划分

### P0（MVP 必需）
- **仓库列表窗口**
  - 添加本地仓库
  - 克隆远程仓库
  - 仓库列表展示和管理
  - 持久化存储
- **命令行启动**
  - `prism` - 打开仓库列表
  - `prism <path>` - 打开指定仓库
  - 自动查找仓库根目录
  - 添加到列表提示
- 打开仓库
- 文件状态查看
- Stage/Unstage
- 创建 Commit
- 提交历史查看
- 基础 Diff 查看

### P1（第一版本）
- 分支管理
- Pull/Push
- 分支图展示
- 搜索过滤

### P2（增强功能）
- Stash
- Tag
- Interactive Rebase
- Conflict 解决

### P3（高级功能）
- Submodule
- Git LFS
- 多仓库管理
- 自定义主题
